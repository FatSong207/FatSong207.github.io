# Elastic Load Balancing (ELB) 完整指南

## 🎯 什麼是 ELB？

Elastic Load Balancing (ELB) 是一種自動分配傳入應用程式流量的 AWS 服務，就像一個**智慧交通管制員**，將流量平均分散到多個伺服器上。

### 🏪 實際比喻：超市收銀台
想像你在超市購物：
- **沒有 ELB**：所有客人都排在同一個收銀台，造成大排長龍
- **有 ELB**：智慧引導客人到空閒的收銀台，減少等待時間

---

## 🔧 ELB 主要功能

### 核心功能
- **流量分配**：自動將請求分散到健康的執行個體
- **健康檢查**：持續監控執行個體狀態
- **自動擴展**：配合 Auto Scaling 動態調整
- **高可用性**：跨多個可用區分散風險

### 運作方式
```
[用戶請求] → [ELB] → [健康檢查] → [選擇執行個體] → [轉發請求]
              ↓
        [監控並記錄]
```

---

## 🚀 AWS 負載平衡器類型完整比較

| 特性 | ALB | NLB | CLB |
|------|-----|-----|-----|
| **OSI 層級** | 第7層 (應用層) | 第4層 (傳輸層) | 第4、7層 |
| **支援協定** | HTTP, HTTPS, WebSocket | TCP, UDP, TLS | HTTP, HTTPS, TCP, SSL |
| **路由功能** | 路徑、主機、標頭 | IP + 連接埠 | 基本負載平衡 |
| **目標類型** | 執行個體、IP、Lambda | 執行個體、IP | 執行個體 |
| **容器支援** | ✅ 完整支援 | ✅ 基本支援 | ❌ 不支援 |
| **WebSocket** | ✅ 原生支援 | ✅ 透過 TCP | ✅ 基本支援 |
| **靜態 IP** | ❌ 不支援 | ✅ 支援 | ❌ 不支援 |
| **SSL 終止** | ✅ 支援 | ✅ 支援 | ✅ 支援 |
| **成本** | 中等 | 較低 | 最低 |

---

## 🎯 各類型詳細介紹

### 1. 🌐 ALB (Application Load Balancer)

**最適合：** 現代 Web 應用程式、微服務架構

**核心特色：**
- **智慧路由**：根據 URL 路徑、主機名稱、HTTP 標頭路由
- **容器友好**：與 ECS、EKS 完美整合
- **現代協定**：支援 HTTP/2、WebSocket
- **SSL 管理**：整合 ACM 憑證管理

**實際應用場景：**
```
電商網站路由規則：
- api.example.com → API 伺服器
- /images/* → 圖片伺服器
- /admin/* → 管理後台
- /mobile/* → 行動版應用
```

### 2. ⚡ NLB (Network Load Balancer)

**最適合：** 高效能應用、遊戲伺服器、IoT 應用

**核心特色：**
- **超低延遲**：微秒級別的延遲
- **高吞吐量**：每秒處理數百萬請求
- **靜態 IP**：提供固定的 IP 地址
- **保留來源 IP**：不修改原始請求的 IP

**實際應用場景：**
```
遊戲伺服器架構：
- 遊戲客戶端 → NLB → 遊戲伺服器群
- 需要極低延遲和高吞吐量
- 保留玩家真實 IP 用於地理位置判斷
```

### 3. 🔄 CLB (Classic Load Balancer)

**最適合：** 舊有系統、簡單應用

**核心特色：**
- **基本功能**：提供基礎的負載平衡
- **成本最低**：最經濟的選擇
- **相容性**：支援 EC2-Classic 網路

**⚠️ 注意：** AWS 建議新項目使用 ALB 或 NLB

---

## 🎯 實際項目例子：電商平台

### 項目需求
- **前端**：React SPA 應用
- **API**：Node.js 後端服務
- **圖片服務**：靜態資源伺服器
- **管理後台**：PHP 管理系統

### ELB 架構設計
```
                [Route 53 DNS]
                       ↓
                    [ALB]
                  /   |   \
                 /    |    \
              前端   API   管理後台
           (React) (Node.js) (PHP)
              ↓       ↓       ↓
         [EC2 群組] [EC2 群組] [EC2 群組]
```

### 路由規則設定
```
ALB 路由規則：
├─ api.shop.com → API 伺服器 (目標群組 A)
├─ admin.shop.com → 管理後台 (目標群組 B)
├─ /images/* → 圖片伺服器 (目標群組 C)
└─ * → 前端應用 (目標群組 D)
```

---

## 💡 選擇負載平衡器指南

### 🎯 決策流程圖
```
需要應用層功能嗎？
├─ 是 → 需要高效能嗎？
│      ├─ 是 → ALB + 優化設定
│      └─ 否 → ALB (標準設定)
└─ 否 → 需要超低延遲嗎？
       ├─ 是 → NLB
       └─ 否 → 預算考量？
              ├─ 緊張 → CLB
              └─ 充足 → NLB
```

### 📊 使用場景

| 應用類型 | 推薦類型 | 原因 |
|----------|----------|------|
| **電商網站** | ALB | 需要路由、SSL 終止、容器支援 |
| **API 服務** | ALB | 需要路徑路由、健康檢查 |
| **遊戲伺服器** | NLB | 需要低延遲、高吞吐量 |
| **IoT 應用** | NLB | 需要 TCP/UDP 支援 |
| **企業內部系統** | CLB | 成本考量、功能簡單 |
| **微服務架構** | ALB | 需要複雜路由、容器支援 |
