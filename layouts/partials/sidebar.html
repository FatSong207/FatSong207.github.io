{{ $data := index .Site.Data .Site.Language.Lang .Section "sidebar" }}

{{- $url := split .Permalink "/" -}}
{{- $urlPageSlug := index $url (sub (len $url) 2) -}}

{{ $currentLang := .Site.Language.Lang }}
{{ $defaultLang := .Sites.Default.Language.Lang }}

<aside id="sidebar">
  <span class="btn-close"><i class="icon icon-close"></i></span>

  <div class="sticky">
    {{- range $group := $data -}}
      <strong class="sidebar-section">{{ $group.title }}</strong>

      {{- range $index, $page := $group.pages -}}
        {{- $pageSlug := "" -}}
        {{- if $page.slug -}}
          {{- $pageSlug = $page.slug -}}
        {{- else -}}
          {{- $pageSlug = $page.title | urlize -}}
        {{- end -}}
        {{- $isActivePage := eq $urlPageSlug $pageSlug -}}

        {{ if eq $currentLang $defaultLang }}
          {{ if eq $pageSlug "" }}
            {{ $href := printf "/%s/" $.Section }}
            <a class="sidebar-link {{ if $isActivePage }}current{{ end }}" href="{{ $href }}">
              {{ $page.title }}
            </a>
          {{ else }}
            {{ $href := printf "/%s/%s/" $.Section $pageSlug }}
            <a class="sidebar-link {{ if $isActivePage }}current{{ end }}" href="{{ $href }}">
              {{ $page.title }}
            </a>
          {{ end }}
        {{ else }}
          {{ if eq $pageSlug "" }}
            {{ $href := printf "/%s/%s/" $currentLang $.Section }}
            <a class="sidebar-link {{ if $isActivePage }}current{{ end }}" href="{{ $href }}">
              {{ $page.title }}
            </a>
          {{ else }}
            {{ $href := printf "/%s/%s/%s/" $currentLang $.Section $pageSlug }}
            <a class="sidebar-link {{ if $isActivePage }}current{{ end }}" href="{{ $href }}">
              {{ $page.title }}
            </a>
          {{ end }}
        {{ end }}
      {{- end }}

    {{- end }}
  </div>
</aside>